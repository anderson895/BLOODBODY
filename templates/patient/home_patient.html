{% include '/components/header.html' %}


<!-- <pre>{{ session | tojson(indent=4) }}</pre> -->



<body class="bg-white from-red-700 to-white min-h-screen flex flex-col">
    {% include 'PageSpinner.html' %}
    <!-- Navbar -->
    <nav class="bg-[#a22133] text-white py-4 px-8 flex justify-between items-center shadow-lg">
        <div class="flex items-center space-x-3">
            <img src="/static/ELEMENTS/LOGO.png" alt="BloodBuddy Logo" class="h-10">
            <span class="text-xl font-bold tracking-wide">BLOODBUDDY</span>
        </div>

        <!-- Desktop Menu -->
        <div class="hidden md:flex space-x-6 items-center">
            <a href="/patient/home_patient" class="bg-pink-200 text-red-800 px-5 py-2 rounded-full font-semibold shadow-md hover:bg-pink-300">HOME</a>
            <a href="/patient/about_patient" class="text-white hover:underline" >ABOUT</a>
            
            <!-- User Icon with Dropdown -->
            <div class="relative">
                <button id="user-menu-button" class="focus:outline-none">
                    <span class="material-icons text-white text-3xl">account_circle</span>
                </button>
                <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white text-black shadow-lg rounded-lg overflow-hidden">
                    <a href="#" class="block px-4 py-2 hover:bg-gray-200">Profile</a>
                    <a href="#" class="block px-4 py-2 hover:bg-gray-200">Settings</a>
                    <a href="/logout" class="block px-4 py-2 hover:bg-gray-200">Logout</a>
                </div>
            </div>
        </div>

        <!-- Mobile Menu Button -->
        <button class="md:hidden focus:outline-none" onclick="toggleMenu()">
            <svg class="w-8 h-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
            </svg>
        </button>
    </nav>

    <!-- Mobile Menu (Hidden by Default) -->
    <div id="mobile-menu" class="hidden md:hidden flex flex-col bg-[#a22133] text-white text-center py-4 space-y-4">
        <a href="/patient/home_patient" class="hover:underline">HOME</a>
        <a href="/about" class="bg-pink-200 text-red-800 px-5 py-2 rounded-full font-semibold shadow-md hover:bg-pink-300 mx-6">ABOUT</a>
        <a href="/logout" class="hover:underline">Logout</a>
    </div>

    <script>
        function toggleMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        document.getElementById('user-menu-button').addEventListener('click', function () {
            document.getElementById('user-dropdown').classList.toggle('hidden');
        });


     
    </script>




<!-- START PAGE CONTENT -->
<div class="flex justify-center items-center h-screen">
    <div id="form-container" class="bg-white p-8 rounded-lg shadow-md w-full max-w-md text-center">
        <h1 class="text-2xl font-bold text-red-700 italic">FIND YOUR MATCH INSTANTLY!</h1>
        <p class="text-gray-600 mt-2">Enter your blood type to see donation and transfusion compatibility in seconds.</p>
        <div class="mt-4">
            <label for="blood-type" class="block text-gray-700 font-medium">Select your blood type:</label>
            <select id="blood-type" class="w-full p-3 border border-red-700 rounded-md focus:ring-2 focus:ring-red-500">
                <option value="">Select your blood type</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
            </select>
        </div>
        <p id="error-message" class="text-red-600 text-sm hidden mt-2">Please select a blood type.</p>
        <button id="check-compatibility" class="mt-6 w-full bg-red-700 text-white font-bold py-3 rounded-md hover:bg-red-800 transition disabled:opacity-50" disabled>CHECK COMPATIBILITY</button>
    </div>

    <div id="result-container" class="hidden bg-white p-8 rounded-lg shadow-md w-full max-w-md text-center" aria-live="polite">
        <h1 id="result-title" class="text-2xl font-bold text-red-700 italic"></h1>
        <div class="mt-4 border border-red-700 rounded-md">
            <div class="grid grid-cols-2 bg-red-700 text-white font-bold">
                <div class="p-3">BLOOD TYPES YOU CAN RECEIVE</div>
                <div class="p-3">BLOOD TYPES YOU CAN DONATE TO</div>
            </div>
            <div class="grid grid-cols-2 text-red-700 font-bold p-3">
                <div id="receive-list"></div>
                <div id="donate-list"></div>
            </div>
        </div>
        <p class="mt-4 italic text-gray-600">Would you like to donate or receive blood?</p>
        <div class="mt-4 flex justify-center space-x-4">
            <button id="donate-button" class="bg-red-700 text-white font-bold py-2 px-4 rounded-md hover:bg-red-800 transition">DONATE</button>
            <button class="bg-red-700 text-white font-bold py-2 px-4 rounded-md hover:bg-red-800 transition">RECEIVE</button>
            <button id="reset" class="bg-gray-500 text-white font-bold py-2 px-4 rounded-md hover:bg-gray-600 transition">NOT TODAY</button>
        </div>
    </div>









    
<!-- DONOR FORM (Hidden by Default) -->
<div id="donor-form" class="hidden bg-white p-8 rounded-lg shadow-md w-full max-w-md text-center">
    <h1 class="text-2xl font-bold text-red-700 italic  text-white p-3 rounded-md">HELLO, DONOR!</h1>
    <p class="text-gray-600 italic mt-2">FILL UP THE INFORMATION BELOW:</p>

    <form id="frmDonate">
        <div class="mt-4 text-left">
            <!-- Spinner -->
            <div class="spinner"  style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999;">
                <div class="absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center">
                    <div class="w-10 h-10 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
                </div>
            </div>


           
            <input type="hidden" name="donor_id" id="donor-id" class="w-full p-3 border border-red-700 rounded-md focus:ring-2 focus:ring-red-500" value="{{ session['patient_id'] }}">


            <label class="block text-red-700 font-bold">FULL NAME:</label>
            <input type="text" name="donor_name" id="donor-name" class="w-full p-3 border border-red-700 rounded-md focus:ring-2 focus:ring-red-500">

            <label class="block text-red-700 font-bold mt-2">AGE:</label>
            <input type="number" name="donor_age" id="donor-age" class="w-full p-3 border border-red-700 rounded-md focus:ring-2 focus:ring-red-500">

            <label class="block text-red-700 font-bold mt-2">CITY OF RESIDENCE:</label>
            <input type="text" name="donor_city" id="donor-city" class="w-full p-3 border border-red-700 rounded-md focus:ring-2 focus:ring-red-500">

            <label class="block text-red-700 font-bold mt-2">CONTACT NUMBER:</label>
            <input type="text" name="donor_contact" id="donor-contact" class="w-full p-3 border border-red-700 rounded-md focus:ring-2 focus:ring-red-500">

            <label class="block text-red-700 font-bold mt-2">EMAIL ADDRESS:</label>
            <input type="email" name="donor_email" id="donor-email" class="w-full p-3 border border-red-700 rounded-md focus:ring-2 focus:ring-red-500">

            <label class="block text-red-700 font-bold mt-2">BLOOD TYPE:</label>
            <select name="donor_bloodtype" id="donor-bloodtype" class="w-full p-3 border border-red-700 rounded-md focus:ring-2 focus:ring-red-500">
                <option value="">Donate blood type</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
            </select>
        </div>

        <button type="submit" id="confirm-donation" class="mt-6 w-full bg-red-700 text-white font-bold py-3 rounded-md hover:bg-red-800 transition">CONFIRM</button>
        <button id="go-back" class="mt-2 w-full bg-gray-500 text-white font-bold py-3 rounded-md hover:bg-gray-600 transition">BACK</button>
    </form>
</div>





</div>
<!-- END PAGE CONTENT -->











<script>
    $(document).ready(function() {
        const bloodCompatibility = {
            "A+": { receive: "A+, A-, O+, O-", donate: "A+, AB+" },
            "A-": { receive: "A-, O-", donate: "A+, A-, AB+, AB-" },
            "B+": { receive: "B+, B-, O+, O-", donate: "B+, AB+" },
            "B-": { receive: "B-, O-", donate: "B+, B-, AB+, AB-" },
            "AB+": { receive: "A+, A-, B+, B-, AB+, AB-, O+, O-", donate: "AB+" },
            "AB-": { receive: "A-, B-, AB-, O-", donate: "AB+, AB-" },
            "O+": { receive: "O+, O-", donate: "O+, A+, B+, AB+" },
            "O-": { receive: "O-", donate: "O+, O-, A+, A-, B+, B-, AB+, AB-" }
        };

        // Enable/disable button based on selection
        $("#blood-type").change(function() {
            let bloodType = $(this).val();
            $("#check-compatibility").prop("disabled", bloodType === "");
            $("#error-message").hide();
        });

        // Check blood compatibility
        $("#check-compatibility").click(function() {
            let bloodType = $("#blood-type").val();
            if (bloodType && bloodCompatibility[bloodType]) {
                $("#result-title").text(`YOU ARE BLOOD TYPE ${bloodType} !`);
                $("#receive-list").text(bloodCompatibility[bloodType].receive);
                $("#donate-list").text(bloodCompatibility[bloodType].donate);
                $("#form-container").fadeOut(300, function() {
                    $("#result-container").fadeIn(300);
                });
            } else {
                $("#error-message").fadeIn();
            }
        });

        // Reset form
        $("#reset").click(function() {
            $("#result-container").fadeOut(300, function() {
                $("#form-container").fadeIn(300);
                $("#blood-type").val("");
                $("#check-compatibility").prop("disabled", true);
            });
        });



  // Show Donor Form when Donate is clicked
        $("#donate-button").click(function() {
            let bloodType = $("#blood-type").val();
            if (bloodType && bloodCompatibility[bloodType]) {
                let donateOptions = bloodCompatibility[bloodType].donate.split(", ");

                let donorSelect = $("#donor-bloodtype");
                donorSelect.empty(); // Clear previous options
                donorSelect.append('<option value="">Donate blood type</option>');

                donateOptions.forEach(type => {
                    donorSelect.append(`<option value="${type}">${type}</option>`);
                });

                $("#result-container").fadeOut(300, function() {
                    $("#donor-form").fadeIn(300);
                });
            }
        });
        // Hide Donor Form and go back
        $("#go-back").click(function() {
            $("#donor-form").fadeOut(300, function() {
                $("#result-container").fadeIn(300);
            });
        });

        












            $("#frmDonate").submit(function(e) {
            e.preventDefault();
          
            const donor_name = $('#donor-name').val().trim();
            const donor_age = $('#donor-age').val().trim();
            const donor_city = $('#donor-city').val().trim();
            const donor_contact = $('#donor-contact').val().trim();
            const donor_email = $('#donor-email').val().trim();
            const donor_bloodtype = $('#donor-bloodtype').val().trim();
            const donor_id = $('#donor-id').val().trim();

            if (!donor_name) {
                alertify.error("Please Enter Name.");
                return;
            }
            if (!donor_age) {
                alertify.error("Please Enter Age");
                return;
            }

            if (!donor_city) {
                alertify.error("Please Enter City");
                return;
            }

            if (!donor_contact) {
                alertify.error("Please Enter Contact Number");
                return;
            }
            if (!donor_email) {
                alertify.error("Please Enter Email");
                return;
            }

            if (!donor_bloodtype) {
                alertify.error("Please Select Bloodtype");
                return;
            }

            $('.spinner').show();
            $('#confirm-donation').prop('disabled', true);

            // Create JSON object from form data
            var formData = {
                donor_id: donor_id,
                donor_name: donor_name,
                donor_age: donor_age,
                donor_city: donor_city,
                donor_contact: donor_contact,
                donor_email: donor_email,
                donor_bloodtype: donor_bloodtype
            };

            // Send data to the server
            $.ajax({
                type: "POST",
                url: "/post_patient_donate",
                contentType: "application/json",
                data: JSON.stringify(formData),
                dataType: "json",
                success: function(response) {

                    console.log(response);
                    
                    if (response.status == "success") {
                        console.log(response);
                        alertify.success(response.message);
                        setTimeout(function() {
                            window.location.href = "/patient/donation_success";
                        }, 1000);
                    } else if (response.status === "error") {
                        alertify.error(response.message);
                        $('.spinner').hide();
                        $('#btnSignup').prop('disabled', false);
                    }
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error:", status, error);
                    alertify.error("An error occurred while logging in. Please try again.");
                }
            });
        });
    });
</script>


{% include '/components/footer.html' %}